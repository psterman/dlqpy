<!DOCTYPE html>
<html>

<head>
    <title>å¤§ä½¬è¯·æ‰¹é˜…</title>
    <script src="https://cdn.jsdelivr.net/npm/lodash@4.17.21/lodash.min.js"></script>
    <style>
        :root {
            --bg-color: #f5f7fa;
            --card-bg: #fff;
            --text-color: #666;
            --shadow-color: rgba(0, 0, 0, 0.1);
            --counter-bg: rgba(255, 255, 255, 0.9);
        }

        [data-theme="dark"] {
            --bg-color: #1a1a1a;
            --card-bg: #2d2d2d;
            --text-color: #e0e0e0;
            --shadow-color: rgba(0, 0, 0, 0.3);
            --counter-bg: rgba(45, 45, 45, 0.9);
        }

        body {
            background-color: var(--bg-color);
            transition: background-color 0.3s ease;
        }

        /* ä¿ç•™åŸæœ‰æ ·å¼ */
        .image-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 50px;
        }

        .image-card {
            background-color: var(--card-bg);
            border-radius: 8px;
            box-shadow: 0 2px 4px var(--shadow-color);
            padding: 15px;
            max-width: 90%;
            margin: 0 auto;
            cursor: grab;
            user-select: none;
        }

        .image-card img {
            max-width: 100%;
            border-radius: 4px;
        }

        #folder-input {
            display: none;
        }

        .folder-button {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 10px 20px;
            background-color: var(--counter-bg);
            border: none;
            border-radius: 20px;
            color: var(--text-color);
            cursor: pointer;
            z-index: 1000;
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--bg-color);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .loading-text {
            color: var(--text-color);
            font-size: 18px;
            margin-top: 20px;
            text-align: center;
        }

        .swipe-hint {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            color: var(--text-color);
            background-color: var(--counter-bg);
            padding: 10px 20px;
            border-radius: 20px;
            display: flex;
            gap: 20px;
            box-shadow: 0 2px 10px var(--shadow-color);
        }

        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: min(15px, 3vw) min(20px, 4vw);
            border-radius: 20px;
            cursor: pointer;
            box-shadow: 0 2px 10px var(--shadow-color);
            z-index: 1000;
            font-size: min(16px, 4vw);
            border: none;
            color: var(--text-color);
            background-color: var(--counter-bg);
            transition: all 0.3s ease;
            min-width: min(120px, 25vw);
        }

        .exit-button {
            position: fixed;
            top: 20px;
            left: 20px;
            padding: min(15px, 3vw) min(20px, 4vw);
            border-radius: 20px;
            cursor: pointer;
            box-shadow: 0 2px 10px var(--shadow-color);
            z-index: 1000;
            font-size: min(16px, 4vw);
            border: none;
            color: var(--text-color);
            background-color: var(--counter-bg);
            transition: all 0.3s ease;
            min-width: min(120px, 25vw);
        }

        .exit-button:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px var(--shadow-color);
        }

        .stats-dialog {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: var(--card-bg);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 20px var(--shadow-color);
            text-align: center;
            color: var(--text-color);
            z-index: 2000;
        }

        .stats-dialog h2 {
            margin-top: 0;
            color: var(--text-color);
        }

        .stats-dialog button {
            margin-top: 20px;
            padding: 10px 20px;
            border: none;
            border-radius: 20px;
            background-color: var(--counter-bg);
            color: var(--text-color);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .stats-dialog button:hover {
            transform: scale(1.05);
        }

        .next-button {
            position: fixed;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            padding: 10px 20px;
            border-radius: 20px;
            background-color: var(--counter-bg);
            color: var(--text-color);
            border: none;
            cursor: pointer;
            box-shadow: 0 2px 10px var(--shadow-color);
            transition: all 0.3s ease;
            display: none;
            /* é»˜è®¤éšè— */
            z-index: 1000;
        }

        .next-button:hover {
            transform: translateX(-50%) scale(1.05);
        }

        .error-message {
            color: var(--text-color);
            text-align: center;
            margin: 20px;
            font-size: 16px;
        }
    </style>
</head>

<body>
    <div id="image-container"></div>

    <script>
        const imageContainer = document.getElementById('image-container');
        let currentIndex = 0;
        let funnyCount = 0;
        let images = [];
        let preloadedImages = new Map();  // ç”¨äºå­˜å‚¨é¢„åŠ è½½çš„å›¾ç‰‡

        // åŠ è½½æ—¶çš„èˆ”ç‹—æ–‡æ¡ˆ
        const loadingTexts = [
            "å¥´æ‰æ­£åœ¨ä¸ºçš‡ä¸Šå‡†å¤‡å¥æŠ˜...",
            "å°çš„æ­£åœ¨æ•´ç†å¾¡è§ˆèµ„æ–™...",
            "å¥´æ‰æ–—èƒ†ä¸ºé™›ä¸‹ç­›é€‰...",
            "æ³è¯·åœ£ä¸Šç¨å€™ç‰‡åˆ»...",
            "å¥´æ‰æ­£åœ¨è¯šæƒ¶è¯šæåœ°å‡†å¤‡...",
            "å®¹å¥´æ‰ä¸ºé™›ä¸‹ç²¾é€‰...",
            "å¥´æ‰æ­£åœ¨æˆ˜æˆ˜å…¢å…¢åœ°æ•´ç†...",
            "è¯·å®¹å¥´æ‰ä¸ºåœ£ä¸Šè¿‡ç›®...",
            "å¥´æ‰æ­£åœ¨ä¸ºä¸‡å²çˆ·å‡†å¤‡...",
            "å°çš„ä¸æ•¢æ€ æ…¢ï¼Œé©¬ä¸Šå‘ˆä¸Š...",
            "å¥´æ‰æ­£åœ¨ç”¨å¿ƒå‡†å¤‡...",
            "æ³è¯·é™›ä¸‹ç¨ä½œä¼‘æ¯...",
            "å¥´æ‰æ­£åœ¨ä¸ºåœ£ä¸Šæ•ˆåŠ³...",
            "å®¹å¥´æ‰ä¸ºé™›ä¸‹ç­›é€‰ç²¾å“...",
            "å°çš„æ­£åœ¨ç«­å°½å…¨åŠ›å‡†å¤‡...",
            "å¥´æ‰æ­£åœ¨ä¸ºçš‡ä¸Šç²¾å¿ƒæŒ‘é€‰...",
            "è¯·å®¹å¥´æ‰å†åšç»†é€‰...",
            "ä¸‡å²çˆ·è¯·ç¨å€™ï¼Œé©¬ä¸Šå‘ˆä¸Š...",
            "å¥´æ‰æ­£åœ¨ä¸ºé™›ä¸‹å¿™ç¢Œ...",
            "å°çš„ä¸æ•¢æ‡ˆæ€ ï¼Œå³åˆ»å‘ˆé€’...",
            "æ³è¯·åœ£ä¸Šç¨ä½œæ­‡æ¯...",
            "å¥´æ‰æ­£åœ¨ä¸ºé™›ä¸‹æ•ˆå‘½...",
            "å®¹å°çš„ä¸ºçš‡ä¸Šå‡†å¤‡...",
            "å¥´æ‰æ­£åœ¨ä¸ºä¸‡å²çˆ·ç”„é€‰...",
            "è¯·å®¹å¥´æ‰ä¸ºåœ£ä¸Šæ•´ç†...",
            "å°çš„æ­£åœ¨ä¸ºé™›ä¸‹å¿™æ´»...",
            "å¥´æ‰æ­£åœ¨ä¸ºçš‡ä¸Šç­›é€‰...",
            "æ³è¯·ä¸‡å²çˆ·ç¨ç­‰ç‰‡åˆ»...",
            "å¥´æ‰æ­£åœ¨ä¸ºåœ£ä¸Šå‡†å¤‡...",
            "å®¹å°çš„ä¸ºé™›ä¸‹æ•ˆåŠ³...",
            "å¥´æ‰æ­£åœ¨ä¸ºçš‡ä¸Šæ•´ç†...",
            "è¯·å®¹å¥´æ‰ä¸ºä¸‡å²çˆ·å‡†å¤‡...",
            "å°çš„æ­£åœ¨ä¸ºåœ£ä¸Šç­›é€‰...",
            "å¥´æ‰æ­£åœ¨ä¸ºé™›ä¸‹ç”„é€‰...",
            "æ³è¯·çš‡ä¸Šç¨ä½œä¼‘æ¯...",
            "å¥´æ‰æ­£åœ¨ä¸ºåœ£ä¸Šå¿™ç¢Œ...",
            "å®¹å°çš„ä¸ºä¸‡å²çˆ·æ•ˆåŠ³...",
            "å¥´æ‰æ­£åœ¨ä¸ºé™›ä¸‹å‡†å¤‡...",
            "è¯·å®¹å¥´æ‰ä¸ºçš‡ä¸Šæ•´ç†...",
            "å°çš„æ­£åœ¨ä¸ºåœ£ä¸Šæ•ˆå‘½...",
            "å¥´æ‰æ­£åœ¨ä¸ºä¸‡å²çˆ·ç­›é€‰...",
            "æ³è¯·é™›ä¸‹ç¨å€™ç‰‡åˆ»...",
            "å¥´æ‰æ­£åœ¨ä¸ºçš‡ä¸Šç”„é€‰...",
            "å®¹å°çš„ä¸ºåœ£ä¸Šæ•ˆåŠ³...",
            "å¥´æ‰æ­£åœ¨ä¸ºé™›ä¸‹æ•´ç†...",
            "è¯·å®¹å¥´æ‰ä¸ºä¸‡å²çˆ·å‡†å¤‡...",
            "å°çš„æ­£åœ¨ä¸ºåœ£ä¸Šç­›é€‰...",
            "å¥´æ‰æ­£åœ¨ä¸ºçš‡ä¸Šæ•ˆå‘½...",
            "æ³è¯·ä¸‡å²çˆ·ç¨ç­‰ç‰‡åˆ»...",
            "å¥´æ‰æ­£åœ¨ä¸ºé™›ä¸‹å¿™æ´»..."
        ];

        // å·¦æ»‘æ–‡æ¡ˆ
        const dislikeTexts = [
            "æœ•å·²é˜…",
            "é€€ä¸‹å§",
            "ä¸å‡†å¥",
            "æ— è¶£",
            "æ¯ç‡¥",
            "ä¹å‘³",
            "æœ•ä¸æ‚¦",
            "è’è°¬",
            "èƒ¡é—¹",
            "æ”¾è‚†",
            "å¤§èƒ†",
            "è’å”",
            "ç³Šæ¶‚",
            "ä¸çŸ¥æ‰€è°“",
            "å²‚æœ‰æ­¤ç†",
            "æœ•ç´¯äº†",
            "æœ•ä¹äº†",
            "æœ•å€¦äº†",
            "ä¸‹ä¸€ä¸ª",
            "ä¸å€¼ä¸€çœ‹",
            "ä¼‘å¾—èƒ¡è¨€",
            "ç®€ç›´å¯ç¬‘",
            "æ— ç¨½ä¹‹è°ˆ",
            "æœ•ä¸æƒ³çœ‹",
            "å¤ªè¿‡æ— èŠ",
            "éš¾ç™»å¤§é›…",
            "ä¸çŸ¥å¤©é«˜åœ°åš",
            "ä¸çŸ¥åˆ†å¯¸",
            "å¤ªè¿‡è‰ç‡",
            "æœ•çœ‹ä¸ä¸‹å»äº†",
            "æœ‰è¾±æ–¯æ–‡",
            "è´»ç¬‘å¤§æ–¹",
            "ä¸çŸ¥æ£€ç‚¹",
            "ä¸å ªå…¥ç›®",
            "æœ•ç”šå¤±æœ›",
            "ä¸çŸ¥æ‚”æ”¹",
            "ä¸çŸ¥è¿›é€€",
            "ä¸çŸ¥è½»é‡",
            "ä¸çŸ¥å¥½æ­¹",
            "ä¸çŸ¥ç¾è€»",
            "æœ•å¿ƒçƒ¦äº†",
            "æœ•ä¸å‡†",
            "æœ•ä¸è®¸",
            "æœ•ä¸è¦",
            "ç€å®æ— è¶£",
            "ç”šæ˜¯æ— å‘³",
            "ä»¤æœ•ç”ŸåŒ",
            "ä»¤æœ•ä¸å¿«",
            "ä»¤æœ•åæ„Ÿ",
            "ä»¤æœ•ä½œå‘•"
        ];

        // å³æ»‘æ–‡æ¡ˆ
        const likeTexts = [
            "é¾™é¢œå¤§æ‚¦",
            "å‡†å¥",
            "ç”šå¥½",
            "ä¸é”™",
            "æœ‰è¶£",
            "å¦™å“‰",
            "çˆ±å¿è¯´å¾—å¥½",
            "æœ•å¾ˆæ¬£æ…°",
            "å¯",
            "å‡†",
            "å¾¡ç¬”äº²æ‰¹",
            "æœ•å‡†äº†",
            "ç”šå¦™",
            "å¦™ä¸å¯è¨€",
            "æ·±å¾—æœ•å¿ƒ",
            "æœ•å¾ˆæ»¡æ„",
            "å–„",
            "æå¥½",
            "æœ•ç¬‘äº†",
            "å¿å®¶æœ‰æ‰",
            "æœç„¶ç²¾å½©",
            "æ·±å¾—æœ•æ„",
            "æœ•ç”šæ¬¢å–œ",
            "å¦™ç¬”ç”ŸèŠ±",
            "æ‰æ€æ•æ·",
            "æœ•è¦é‡èµ",
            "å¿å®¶å¦™æ",
            "çœŸä¹ƒå¤§æ‰",
            "æœ•è¦å¤šçœ‹å‡ é",
            "ä¼ æœ•æ—¨æ„",
            "æœ•é¾™å¿ƒå¤§æ‚¦",
            "å¦™ä¸å¯è¨€",
            "ç»å¦™å¥½è¾",
            "æœ•å‡†äº†",
            "ç”šåˆæœ•æ„",
            "çˆ±å¿ç”¨å¿ƒäº†",
            "æœ•å¾ˆå–œæ¬¢",
            "å¯åœˆå¯ç‚¹",
            "ä»¤æœ•å¼€æ€€",
            "å¦™è¶£æ¨ªç”Ÿ",
            "æœ•è¦èµèµ",
            "æœ•è¦å˜‰å¥–",
            "æœ•è¦è¤’å¥–",
            "æœ•è¦è¡¨å½°",
            "æœ•è¦å¤¸èµ",
            "æœ•å¿ƒç”šæ‚¦",
            "æœ•æ„ç”šæ…°",
            "æœ•å¿ƒå¤§å¿«",
            "æœ•æ„å¤§ç•…",
            "æœ•å¿ƒèˆ’ç•…"
        ];

        // ä½¿ç”¨ GitHub API è·å–ä»“åº“ä¸­ pic æ–‡ä»¶å¤¹çš„å†…å®¹
        const owner = 'psterman';
        const repo = 'dlqpy';
        const path = 'pic';

        async function loadImages() {
            const loadingOverlay = showLoading();
            try {
                const response = await fetch(
                    `https://api.github.com/repos/${owner}/${repo}/contents/${path}`
                );

                const files = await response.json();

                // è¿‡æ»¤å‡ºå›¾ç‰‡æ–‡ä»¶
                images = files
                    .filter(file => file.name.match(/\.(jpg|jpeg|png|gif)$/i))
                    .map(file => ({
                        url: file.download_url,
                        name: file.name
                    }));

                if (images.length > 0) {
                    images = _.shuffle(images);
                    // é¢„åŠ è½½ç¬¬ä¸€å¼ å›¾ç‰‡
                    const firstImage = new Image();
                    firstImage.src = images[0].url;
                    preloadedImages.set(images[0].url, firstImage);
                    // é¢„åŠ è½½ç¬¬äºŒå¼ å›¾ç‰‡
                    preloadNextImage(0);
                    showImage(0);
                }
            } finally {
                hideLoading(loadingOverlay);
            }
        }

        function showLoading() {
            const overlay = document.createElement('div');
            overlay.className = 'loading-overlay';

            const text = document.createElement('div');
            text.className = 'loading-text';
            text.textContent = loadingTexts[Math.floor(Math.random() * loadingTexts.length)];

            overlay.appendChild(text);
            document.body.appendChild(overlay);
            return overlay;
        }

        function hideLoading(overlay) {
            overlay.style.opacity = '0';
            overlay.style.transition = 'opacity 0.3s ease';
            setTimeout(() => overlay.remove(), 300);
        }

        function showImage(index) {
            imageContainer.innerHTML = '';

            const container = document.createElement('div');
            container.className = 'image-container';

            const card = document.createElement('div');
            card.className = 'image-card';

            const img = document.createElement('img');
            // æ·»åŠ å›¾ç‰‡åŠ è½½é”™è¯¯å¤„ç†
            img.onerror = () => {
                // é”™è¯¯æç¤ºæ–‡æ¡ˆ
                const errorTexts = [
                    "è¿™ä»½å¥æŠ˜ä¼¼ä¹é—å¤±åœ¨å®«ä¸­äº†...",
                    "å¾¡å‰æ€»ç®¡å·æ‡’æ²¡æœ‰åŠæ—¶é€è¾¾...",
                    "è¿™ä»½å¥æŠ˜è¢«èŒ¶æ°´æµ¸æ¹¿äº†ï¼Œå¾…æœ•æ‰¾å¤ªç›‘é‡æ–°èªŠæŠ„...",
                    "è¿™ä»½å¥æŠ˜è¢«æ˜¨æ™šçš„é£å¹èµ°äº†ï¼Œå®¹å¥´æ‰å»å¯»æ‰¾...",
                    "è¿™ä»½å¥æŠ˜è¢«çš‡åå¨˜å¨˜æ‹¿å»å«æ¡Œè„šäº†...",
                    "è¿™ä»½å¥æŠ˜è¢«å°å¤ªç›‘å½“æˆæ‰‹çº¸ç”¨äº†...",
                    "è¿™ä»½å¥æŠ˜è¢«è´ªç©çš„å°çš‡å­æ’•äº†ï¼Œæœ•é‡æ–°æ‰¾äººèªŠæŠ„...",
                    "è¿™ä»½å¥æŠ˜è¢«å®«å¥³ä¸å°å¿ƒæ‰«è¿›åƒåœ¾å †äº†...",
                    "è¿™ä»½å¥æŠ˜è¢«ç²˜åœ¨ä¸€èµ·äº†ï¼Œå®¹å¥´æ‰åˆ†å¼€...",
                    "è¿™ä»½å¥æŠ˜è¢«å¤ªç›‘æ”¾é”™åœ°æ–¹äº†ï¼Œå¾…æœ•æ´¾äººæ‰¾æ‰¾..."
                ];

                // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
                const errorMsg = document.createElement('div');
                errorMsg.className = 'error-message';
                errorMsg.textContent = errorTexts[Math.floor(Math.random() * errorTexts.length)];
                card.appendChild(errorMsg);

                // æ˜¾ç¤ºä¸‹ä¸€å¼ æŒ‰é’®
                const nextButton = document.createElement('button');
                nextButton.className = 'next-button';
                nextButton.textContent = 'ä¸‹ä¸€ä»½å¥æŠ˜';
                nextButton.onclick = () => {
                    currentIndex++;
                    showImage(currentIndex);
                    checkAndResetImages();
                };
                document.body.appendChild(nextButton);
            };

            // ä½¿ç”¨é¢„åŠ è½½çš„å›¾ç‰‡ï¼ˆå¦‚æœæœ‰ï¼‰
            const currentImage = images[index];
            if (preloadedImages.has(currentImage.url)) {
                img.src = preloadedImages.get(currentImage.url).src;
            } else {
                img.src = currentImage.url;
            }
            img.alt = images[index].name;

            card.appendChild(img);
            container.appendChild(card);
            imageContainer.appendChild(container);

            // ç§»é™¤æ—§çš„ä¸‹ä¸€å¼ æŒ‰é’®ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
            const oldNextButton = document.querySelector('.next-button');
            if (oldNextButton) {
                oldNextButton.remove();
            }

            // ç§»é™¤æ—§çš„æ»‘åŠ¨æç¤ºï¼ˆå¦‚æœå­˜åœ¨ï¼‰
            const oldHint = document.querySelector('.swipe-hint');
            if (oldHint) {
                oldHint.remove();
            }

            // æ·»åŠ æ»‘åŠ¨æç¤º
            const hint = document.createElement('div');
            hint.className = 'swipe-hint';
            hint.innerHTML = `<span>ğŸ‘ˆ ${getRandomText(false)}</span><span>${getRandomText(true)} ğŸ‘‰</span>`;
            document.body.appendChild(hint);
        }

        function getRandomText(isLike) {
            const texts = isLike ? likeTexts : dislikeTexts;
            return texts[Math.floor(Math.random() * texts.length)];
        }

        // æ·»åŠ å·¦å³æ»‘åŠ¨å¤„ç†
        let startX = 0;
        let currentX = 0;
        let startTime = 0;  // è®°å½•å¼€å§‹æ»‘åŠ¨çš„æ—¶é—´
        let isMoving = false;  // æ ‡è®°æ˜¯å¦åœ¨æ»‘åŠ¨ä¸­
        let isMouseDown = false;

        // æ·»åŠ é”®ç›˜äº‹ä»¶ç›‘å¬
        document.addEventListener('keydown', handleKeyPress);

        function handleKeyPress(e) {
            const card = document.querySelector('.image-card');
            if (!card) return;

            switch (e.key) {
                case 'ArrowLeft':
                    // å·¦ç®­å¤´ï¼šä¸å–œæ¬¢
                    animateSwipe(card, -1, () => {
                        currentIndex++;
                        showImage(currentIndex);
                        checkAndResetImages();
                    });
                    break;
                case 'ArrowRight':
                    // å³ç®­å¤´ï¼šå–œæ¬¢
                    animateSwipe(card, 1, () => {
                        currentIndex++;
                        funnyCount++;
                        showImage(currentIndex);
                        checkAndResetImages();
                    });
                    break;
            }
        }

        // æ·»åŠ æ»‘åŠ¨åŠ¨ç”»
        function animateSwipe(card, direction, callback) {
            const targetX = direction * window.innerWidth;
            card.style.transition = 'transform 0.3s ease-out';
            card.style.transform = `translateX(${targetX}px)`;

            setTimeout(() => {
                card.style.transition = '';
                callback();
            }, 300);
        }

        // æ£€æŸ¥æ˜¯å¦éœ€è¦é‡ç½®å›¾ç‰‡åˆ—è¡¨
        function checkAndResetImages() {
            if (currentIndex >= images.length) {
                images = _.shuffle(images);
                currentIndex = 0;
                showImage(currentIndex);
            }
        }

        imageContainer.addEventListener('touchstart', handleStart);
        imageContainer.addEventListener('touchmove', handleMove);
        imageContainer.addEventListener('touchend', handleEnd);

        // æ·»åŠ é¼ æ ‡äº‹ä»¶ç›‘å¬
        imageContainer.addEventListener('mousedown', handleMouseStart);
        imageContainer.addEventListener('mousemove', handleMouseMove);
        imageContainer.addEventListener('mouseup', handleMouseEnd);
        imageContainer.addEventListener('mouseleave', handleMouseEnd);

        function handleStart(e) {
            startX = e.touches[0].clientX;
            currentX = startX;
            startTime = Date.now();
            isMoving = true;
        }

        function handleMouseStart(e) {
            isMouseDown = true;
            isMoving = true;
            startX = e.clientX;
            currentX = startX;
            startTime = Date.now();

            // æ·»åŠ æ‹–åŠ¨æ—¶çš„é¼ æ ‡æ ·å¼
            const card = document.querySelector('.image-card');
            card.style.cursor = 'grabbing';
        }

        function handleMove(e) {
            currentX = e.touches[0].clientX;
            const diff = currentX - startX;
            const card = document.querySelector('.image-card');
            card.style.transform = `translateX(${diff}px)`;
        }

        function handleMouseMove(e) {
            if (!isMouseDown) return;
            e.preventDefault();  // é˜²æ­¢æ‹–åŠ¨æ—¶é€‰ä¸­æ–‡æœ¬

            currentX = e.clientX;
            const diff = currentX - startX;
            const card = document.querySelector('.image-card');
            card.style.transform = `translateX(${diff}px)`;
        }

        function handleEnd(e) {
            if (!isMoving) return;  // å¦‚æœä¸æ˜¯æ»‘åŠ¨çŠ¶æ€ï¼Œç›´æ¥è¿”å›
            isMoving = false;

            const diff = currentX - startX;
            const threshold = window.innerWidth * 0.2;
            const timeElapsed = Date.now() - startTime;
            const velocity = Math.abs(diff) / timeElapsed;  // è®¡ç®—æ»‘åŠ¨é€Ÿåº¦

            if (Math.abs(diff) > threshold || (Math.abs(diff) > 50 && velocity > 0.5)) {
                if (diff > 0) {  // å³æ»‘è¡¨ç¤ºå–œæ¬¢
                    currentIndex++;
                    funnyCount++;
                    showImage(currentIndex);
                } else {  // å·¦æ»‘è¡¨ç¤ºä¸å–œæ¬¢
                    currentIndex++;
                    showImage(currentIndex);
                }
                checkAndResetImages();
            } else {
                // æ¢å¤åŸä½çš„åŠ¨ç”»
                const card = document.querySelector('.image-card');
                card.style.transition = 'transform 0.2s ease-out';
                card.style.transform = 'translateX(0)';
                setTimeout(() => {
                    card.style.transition = '';
                }, 200);
            }
        }

        function handleMouseEnd(e) {
            if (!isMouseDown) return;
            isMouseDown = false;
            isMoving = false;

            // æ¢å¤é»˜è®¤é¼ æ ‡æ ·å¼
            const card = document.querySelector('.image-card');
            card.style.cursor = 'grab';

            handleEnd(e);
        }

        // é¢„åŠ è½½ä¸‹ä¸€å¼ å›¾ç‰‡
        function preloadNextImage(index) {
            const nextIndex = (index + 1) % images.length;
            const nextImage = images[nextIndex];

            if (!preloadedImages.has(nextImage.url)) {
                const img = new Image();
                img.src = nextImage.url;
                preloadedImages.set(nextImage.url, img);
            }
        }

        // æ·»åŠ é€€å‡ºæŒ‰é’®å’Œç»Ÿè®¡åŠŸèƒ½
        function showExitStats() {
            // æ ¹æ®ç¬‘è¯æŒ‡æ•°é€‰æ‹©ä¸åŒçš„è¯„ä»·æ–‡æ¡ˆ
            function getEvaluationText(funnyRate) {
                const evaluations = [
                    // 0-20% è¯„ä»·
                    [
                        "æœ•çœ‹ä½ å“å‘³ç‹¬ç‰¹ï¼Œéš¾å¾—ç³Šæ¶‚å•Š",
                        "çˆ±å¿çš„å¹½é»˜æ„Ÿéœ€è¦æœ•äº²è‡ªè°ƒæ•™",
                        "è¿™å°±æ˜¯ä½ çš„ç¬‘ç‚¹ï¼Ÿæœ•å¾ˆæ‹…å¿§å•Š",
                        "çœ‹æ¥çˆ±å¿ä¸æœ•çš„å“å‘³ç›¸å»ç”šè¿œ",
                        "ä½ è¿™å®¡ç¾ï¼Œæœ•å¾ˆæ˜¯è´¹è§£å•Š"
                    ],
                    // 21-40% è¯„ä»·
                    [
                        "å‹‰å¼ºåŠæ ¼ï¼Œè¿˜éœ€åŠªåŠ›å•Š",
                        "æœ•å¯¹ä½ çš„è¡¨ç°ä¸ç”šæ»¡æ„",
                        "çˆ±å¿çš„çœ¼å…‰å°šéœ€æå‡",
                        "æœ•è§‰å¾—ä½ å¯ä»¥åšå¾—æ›´å¥½",
                        "æœ‰è¿›æ­¥ç©ºé—´ï¼Œç»§ç»­åŠªåŠ›"
                    ],
                    // 41-60% è¯„ä»·
                    [
                        "ä¸é”™ä¸é”™ï¼Œæœ•å¾ˆæ¬£æ…°",
                        "çˆ±å¿çš„å“å‘³æ¸å…¥ä½³å¢ƒ",
                        "çœ‹æ¥ä½ ä¸æœ•å¿ƒæœ‰çµçŠ€",
                        "æœ•å¯¹ä½ çš„è¡¨ç°è¿˜ç®—æ»¡æ„",
                        "ç»§ç»­ä¿æŒï¼Œä¸è¦éª„å‚²"
                    ],
                    // 61-80% è¯„ä»·
                    [
                        "å¾ˆå¥½ï¼Œæ·±å¾—æœ•å¿ƒå•Š",
                        "çˆ±å¿æœç„¶æ‡‚å¾—æœ•çš„å¿ƒæ„",
                        "æœ•çœ‹ä½ å¾ˆæœ‰æ…§æ ¹",
                        "ä¸æ„§æ˜¯æœ•çœ‹ä¸­çš„äººæ‰",
                        "ç”šåˆæœ•æ„ï¼Œç”šåˆæœ•æ„"
                    ],
                    // 81-100% è¯„ä»·
                    [
                        "ç»äº†ï¼æœ•è¦é‡é‡èµèµä½ ",
                        "å¿ä¹ƒæœ•ä¹‹çŸ¥å·±ä¹Ÿ",
                        "æœ•è¦å°ä½ ä¸ºé¦–å¸­ç¬‘è¯é‰´èµå®˜",
                        "çˆ±å¿ä¸æœ•çœŸæ˜¯å¿ƒæœ‰çµçŠ€",
                        "æœ•è¦æŠŠä½ è°ƒåˆ°å¾¡å‰ä¾å¥‰"
                    ]
                ];

                const index = Math.min(Math.floor(funnyRate / 20), 4);
                const texts = evaluations[index];
                return texts[Math.floor(Math.random() * texts.length)];
            }

            const dialog = document.createElement('div');
            dialog.className = 'stats-dialog';

            const title = document.createElement('h2');
            title.textContent = 'å¾¡è§ˆç»Ÿè®¡';

            const content = document.createElement('p');
            const totalImages = images.length;
            const viewedImages = currentIndex + 1;
            const funnyRate = (funnyCount / viewedImages) * 100;
            content.innerHTML = `
                çˆ±å¿å…±è§ˆå¥æŠ˜ ${viewedImages} ç¯‡<br>
                å…¶ä¸­ä»¤æœ•é¾™é¢œå¤§æ‚¦è€… ${funnyCount} ç¯‡<br>
                é¾™å¿ƒæ‚¦æŒ‡æ•°ï¼š${Math.round(funnyRate)}%<br><br>
                <strong>${getEvaluationText(funnyRate)}</strong>
            `;

            const confirmButton = document.createElement('button');
            confirmButton.textContent = 'æœ•çŸ¥é“äº†';
            confirmButton.onclick = () => {
                window.close();
                // å¦‚æœwindow.close()ä¸èµ·ä½œç”¨ï¼Œæä¾›è¿”å›ä¸Šä¸€é¡µçš„é€‰é¡¹
                if (window.location.href === document.referrer) {
                    window.location.href = '/';
                } else {
                    window.history.back();
                }
            };

            dialog.appendChild(title);
            dialog.appendChild(content);
            dialog.appendChild(confirmButton);
            document.body.appendChild(dialog);
        }

        window.addEventListener('DOMContentLoaded', () => {
            // å¯åŠ¨å›¾ç‰‡åŠ è½½
            loadImages();

            // ä¸»é¢˜è®¾ç½®åˆå§‹åŒ–
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);

            const themeToggle = document.createElement('button');
            themeToggle.className = 'theme-toggle';
            themeToggle.textContent = savedTheme === 'dark' ? 'ğŸŒ åˆ‡æ¢äº®è‰²' : 'ğŸŒ™ åˆ‡æ¢æš—è‰²';
            themeToggle.onclick = toggleTheme;
            document.body.appendChild(themeToggle);

            // æ·»åŠ é€€å‡ºæŒ‰é’®
            const exitButton = document.createElement('button');
            exitButton.className = 'exit-button';
            exitButton.textContent = 'é€€å‡º';
            exitButton.onclick = showExitStats;
            document.body.appendChild(exitButton);
        });

        // ä¸»é¢˜åˆ‡æ¢åŠŸèƒ½
        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            const themeToggle = document.querySelector('.theme-toggle');
            themeToggle.textContent = newTheme === 'dark' ? 'ğŸŒ åˆ‡æ¢äº®è‰²' : 'ğŸŒ™ åˆ‡æ¢æš—è‰²';
        }

        // é˜²æ­¢æ»‘åŠ¨è¿‡ç¨‹ä¸­è§¦å‘å…¶ä»–äº‹ä»¶
        imageContainer.addEventListener('click', (e) => {
            if (isMoving) {
                e.preventDefault();
                e.stopPropagation();
            }
        });
    </script>
</body>

</html>