<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>å¤§ä½¬è¯·æ‰¹é˜…</title>
    <script src="https://cdn.jsdelivr.net/npm/lodash@4.17.21/lodash.min.js"></script>
    <style>
        :root {
            --bg-color: #f5f7fa;
            --card-bg: #fff;
            --text-color: #666;
            --shadow-color: rgba(0, 0, 0, 0.1);
            --counter-bg: rgba(255, 255, 255, 0.9);
        }

        [data-theme="dark"] {
            --bg-color: #1a1a1a;
            --card-bg: #2d2d2d;
            --text-color: #e0e0e0;
            --shadow-color: rgba(0, 0, 0, 0.3);
            --counter-bg: rgba(45, 45, 45, 0.9);
        }

        body {
            background-color: var(--bg-color);
            transition: background-color 0.3s ease;
        }

        /* æ·»åŠ é¾™çº¹èƒŒæ™¯ */
        body::before {
            content: 'é¾';
            position: fixed;
            font-size: 400px;
            opacity: 0.03;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-family: "åæ–‡è¡Œæ¥·", "æ¥·ä½“", serif;
            color: var(--text-color);
            pointer-events: none;
            z-index: -1;
        }

        /* ä¿®æ”¹ swipe-hint ç›¸å…³æ ·å¼ */
        .swipe-hint {
            position: fixed !important;
            bottom: 20px !important;
            left: 0 !important;
            right: 0 !important;
            z-index: 1000;
            opacity: 1;
            display: flex;
            justify-content: space-between;
            pointer-events: none;
            background: none !important;
            padding: 0 20px;
        }

        .swipe-hint span {
            min-width: 120px;
            background-color: var(--counter-bg);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            padding: 15px 25px;
            font-size: 16px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 2px 10px var(--shadow-color);
            pointer-events: auto;
            z-index: 1001;
            position: relative;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            cursor: pointer;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            transition: all 0.3s ease;
            border: 1px solid var(--text-color);
        }

        /* ä¿®æ”¹å›¾ç‰‡å®¹å™¨æ ·å¼ */
        .image-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0;
            width: 100%;
            height: calc(100vh - 100px);
            overflow: hidden;
        }

        .image-card {
            background-color: var(--card-bg);
            width: 100%;  /* æ”¹ä¸º100%å®½åº¦ */
            margin: 0 auto;
            position: relative;
            animation: fadeIn 0.3s ease-out;
            display: flex;
            align-items: flex-start;
            justify-content: center;
            overflow-y: auto;
            overflow-x: hidden;
            padding: 10px;
            box-sizing: border-box;
            height: 100%;
            -webkit-overflow-scrolling: touch;
            scroll-behavior: smooth;
            scrollbar-width: none;
        }

        .image-card::-webkit-scrollbar {
            display: none; /* Chrome, Safari and Opera */
        }

        .image-card img {
            width: 100%;  /* å›¾ç‰‡å®½åº¦å§‹ç»ˆ100% */
            height: auto;
            object-fit: contain;
            display: block;
        }

        /* PCç«¯æ»šåŠ¨æ¡æ ·å¼ */
        @media (min-width: 769px) {
            .image-card::-webkit-scrollbar {
                width: 6px;
                background-color: transparent;
            }

            .image-card::-webkit-scrollbar-track {
                background: transparent;
                margin: 10px 0;
            }

            .image-card::-webkit-scrollbar-thumb {
                background-color: var(--text-color);
                opacity: 0.3;
                border-radius: 3px;
                transition: all 0.3s ease;
            }

            .image-card::-webkit-scrollbar-thumb:hover {
                background-color: var(--text-color);
                opacity: 0.5;
            }

            /* é¼ æ ‡æ‚¬åœæ—¶æ˜¾ç¤ºæ»šåŠ¨æ¡ */
            .image-card {
                scrollbar-width: thin;
            }

            .image-card:hover::-webkit-scrollbar-thumb {
                background-color: var(--text-color);
                opacity: 0.5;
            }
        }

        /* ç§»åŠ¨ç«¯éšè—æ»šåŠ¨æ¡ */
        @media (max-width: 768px) {
            .image-container {
                height: calc(100vh - 80px);
                padding: 0;
            }

            .image-card {
                width: 100%;
                padding: 10px;
                height: 100%;
                touch-action: pan-y;
                scrollbar-width: none;
                -ms-overflow-style: none;
            }

            .image-card::-webkit-scrollbar {
                display: none;
            }

            .image-card img {
                width: min(100%, 800px);
                height: auto;
                margin: 0 auto;
            }
        }

        /* æ·»åŠ æ»šåŠ¨æç¤ºåŠ¨ç”» */
        @keyframes scrollHint {
            0% { transform: translateY(0); }
            50% { transform: translateY(10px); }
            100% { transform: translateY(0); }
        }

        .scroll-indicator {
            position: fixed;
            right: calc(50% - min(400px, 50%) - 20px);
            top: 50%;
            transform: translateY(-50%);
            width: 20px;
            height: 40px;
            border: 2px solid var(--text-color);
            border-radius: 10px;
            opacity: 0.5;
            pointer-events: none;
            animation: scrollHint 2s infinite;
            display: none;
        }

        .scroll-indicator::after {
            content: '';
            position: absolute;
            top: 6px;
            left: 50%;
            transform: translateX(-50%);
            width: 4px;
            height: 8px;
            background-color: var(--text-color);
            border-radius: 2px;
        }

        /* åªåœ¨PCç«¯æ˜¾ç¤ºæ»šåŠ¨æç¤º */
        @media (min-width: 769px) {
            .scroll-indicator {
                display: block;
            }
        }

        /* ä¿®æ”¹æ”¾å¤§æ¨¡å¼æ ·å¼ */
        .image-card.zoom-mode {
            overflow: hidden !important;
            height: 100% !important;
        }

        .image-card img.zoomed {
            max-width: none !important;
            width: auto !important;
        }

        #folder-input {
            display: none;
        }

        .folder-button {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 10px 20px;
            background-color: var(--counter-bg);
            border: none;
            border-radius: 20px;
            color: var(--text-color);
            cursor: pointer;
            z-index: 1000;
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--bg-color);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .loading-text {
            color: var(--text-color);
            font-size: 18px;
            margin-top: 20px;
            text-align: center;
        }

        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: min(15px, 3vw) min(20px, 4vw);
            border-radius: 20px;
            cursor: pointer;
            box-shadow: 0 2px 10px var(--shadow-color);
            z-index: 1000;
            font-size: min(16px, 4vw);
            border: none;
            color: var(--text-color);
            background-color: var(--counter-bg);
            transition: all 0.3s ease;
            min-width: min(120px, 25vw);
            border: 1px solid var(--text-color);
            background: linear-gradient(to bottom, var(--counter-bg), var(--card-bg));
        }

        .exit-button {
            position: fixed;
            top: 20px;
            left: 20px;
            padding: min(15px, 3vw) min(20px, 4vw);
            border-radius: 20px;
            cursor: pointer;
            box-shadow: 0 2px 10px var(--shadow-color);
            z-index: 1000;
            font-size: min(16px, 4vw);
            border: none;
            color: var(--text-color);
            background-color: var(--counter-bg);
            transition: all 0.3s ease;
            min-width: min(120px, 25vw);
            border: 1px solid var(--text-color);
            background: linear-gradient(to bottom, var(--counter-bg), var(--card-bg));
        }

        .exit-button:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px var(--shadow-color);
        }

        .stats-dialog {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: var(--card-bg);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 20px var(--shadow-color);
            text-align: center;
            color: var(--text-color);
            z-index: 2000;
            border: 2px solid var(--text-color);
            background: linear-gradient(to bottom, var(--card-bg), var(--counter-bg));
        }

        .stats-dialog h2 {
            margin-top: 0;
            color: var(--text-color);
        }

        .stats-dialog button {
            margin-top: 20px;
            padding: 10px 20px;
            border: none;
            border-radius: 20px;
            background-color: var(--counter-bg);
            color: var(--text-color);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .stats-dialog button:hover {
            transform: scale(1.05);
        }

        .next-button {
            position: fixed;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            padding: 10px 20px;
            border-radius: 20px;
            background-color: var(--counter-bg);
            color: var(--text-color);
            border: none;
            cursor: pointer;
            box-shadow: 0 2px 10px var(--shadow-color);
            transition: all 0.3s ease;
            display: none;
            /* é»˜è®¤éšè— */
            z-index: 1000;
        }

        .next-button:hover {
            transform: translateX(-50%) scale(1.05);
        }

        .error-message {
            color: var(--text-color);
            text-align: center;
            margin: 20px;
            font-size: 16px;
        }

        /* ä¿®æ”¹ç»Ÿè®¡å¼¹çª—æ ·å¼ */
        .stats-dialog::before {
            content: 'ğŸ“œ';
            font-size: 24px;
            display: block;
            margin-bottom: 10px;
        }

        /* æ·»åŠ å›¾ç‰‡åˆ‡æ¢åŠ¨ç”»æ ·å¼ */
        @keyframes slideOutLeft {
            to {
                transform: translateX(-100%) rotate(-5deg);
                opacity: 0;
            }
        }

        @keyframes slideOutRight {
            to {
                transform: translateX(100%) rotate(5deg);
                opacity: 0;
            }
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* æ·»åŠ æ·¡å…¥æ•ˆæœ */
        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        /* æ·»åŠ æµ®åŠ¨æç¤ºæ ·å¼ */
        .floating-hint {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: var(--counter-bg);
            color: var(--text-color);
            padding: 15px 25px;
            border-radius: 20px;
            box-shadow: 0 2px 10px var(--shadow-color);
            border: 1px solid var(--text-color);
            text-align: center;
            z-index: 10000;
            animation: fadeInOut 3s ease-in-out forwards;
            pointer-events: none;
        }

        @keyframes fadeInOut {
            0% {
                opacity: 0;
            }

            20% {
                opacity: 1;
            }

            80% {
                opacity: 1;
            }

            100% {
                opacity: 0;
            }
        }

        /* æ¡Œé¢ç«¯æ ·å¼ */
        @media (min-width: 769px) {
            .image-container {
                height: calc(100vh - 100px);
                /* ç•™å‡ºé¡¶éƒ¨å’Œåº•éƒ¨ç©ºé—´ */
                max-width: 800px;
                /* é™åˆ¶æœ€å¤§å®½åº¦ */
                margin: 50px auto;
            }

            .image-card {
                background-color: var(--card-bg);
                border-radius: 12px;
                box-shadow: 0 4px 20px var(--shadow-color);
                padding: 20px;
                height: 100%;
                width: 100%;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .image-card img {
                width: 100%;
                height: 100%;
                object-fit: contain;
                max-height: calc(100vh - 140px);
                /* ç¡®ä¿å›¾ç‰‡ä¸ä¼šå¤ªé«˜ */
            }

            .swipe-hint {
                bottom: -40px;
                /* è°ƒæ•´æç¤ºä½ç½® */
            }
        }
    </style>
</head>

<body>
    <div id="image-container"></div>

    <script>
        const imageContainer = document.getElementById('image-container');
        let currentIndex = 0;
        let funnyCount = 0;
        let images = [];
        let preloadedImages = new Map();
        const MAX_CACHED_IMAGES = 50;  // å¢åŠ ç¼“å­˜æ•°é‡
        let isLoading = false;  // æ·»åŠ åŠ è½½çŠ¶æ€æ ‡è®°
        let lastTapTime = 0;
        let tapCount = 0;
        let longPressTimer;

        // åŠ è½½æ—¶çš„èˆ”ç‹—æ–‡æ¡ˆ
        const loadingTexts = [
            "å¥´æ‰æ­£åœ¨ä¸ºçš‡ä¸Šå‡†å¤‡å¥æŠ˜...",
            "å°çš„æ­£åœ¨æ•´ç†å¾¡è§ˆèµ„æ–™...",
            "å¥´æ‰æ–—èƒ†ä¸ºé™›ä¸‹ç­›é€‰...",
            "æ³è¯·åœ£ä¸Šç¨å€™ç‰‡åˆ»...",
            "å¥´æ‰æ­£åœ¨è¯šæƒ¶è¯šæåœ°å‡†å¤‡...",
            "å®¹å¥´æ‰ä¸ºé™›ä¸‹ç²¾é€‰...",
            "å¥´æ‰æ­£åœ¨æˆ˜æˆ˜å…¢å…¢åœ°æ•´ç†...",
            "è¯·å®¹å¥´æ‰ä¸ºåœ£ä¸Šè¿‡ç›®...",
            "å¥´æ‰æ­£åœ¨ä¸ºä¸‡å²çˆ·å‡†å¤‡...",
            "å°çš„ä¸æ•¢æ€ æ…¢ï¼Œé©¬ä¸Šå‘ˆä¸Š...",
            "å¥´æ‰æ­£åœ¨ç”¨å¿ƒå‡†å¤‡...",
            "æ³è¯·é™›ä¸‹ç¨ä½œä¼‘æ¯...",
            "å¥´æ‰æ­£åœ¨ä¸ºåœ£ä¸Šæ•ˆåŠ³...",
            "å®¹å¥´æ‰ä¸ºé™›ä¸‹ç­›é€‰ç²¾å“...",
            "å°çš„æ­£åœ¨ç«­å°½å…¨åŠ›å‡†å¤‡...",
            "å¥´æ‰æ­£åœ¨ä¸ºçš‡ä¸Šç²¾å¿ƒæŒ‘é€‰...",
            "è¯·å®¹å¥´æ‰å†åšç»†é€‰...",
            "ä¸‡å²çˆ·è¯·ç¨å€™ï¼Œé©¬ä¸Šå‘ˆä¸Š...",
            "å¥´æ‰æ­£åœ¨ä¸ºé™›ä¸‹å¿™ç¢Œ...",
            "å°çš„ä¸æ•¢æ‡ˆæ€ ï¼Œå³åˆ»å‘ˆé€’...",
            "æ³è¯·åœ£ä¸Šç¨ä½œæ­‡æ¯...",
            "å¥´æ‰æ­£åœ¨ä¸ºé™›ä¸‹æ•ˆå‘½...",
            "å®¹å°çš„ä¸ºçš‡ä¸Šå‡†å¤‡...",
            "å¥´æ‰æ­£åœ¨ä¸ºä¸‡å²çˆ·ç”„é€‰...",
            "è¯·å®¹å¥´æ‰ä¸ºåœ£ä¸Šæ•´ç†...",
            "å°çš„æ­£åœ¨ä¸ºé™›ä¸‹å¿™æ´»...",
            "å¥´æ‰æ­£åœ¨ä¸ºçš‡ä¸Šç­›é€‰...",
            "æ³è¯·ä¸‡å²çˆ·ç¨ç­‰ç‰‡åˆ»...",
            "å¥´æ‰æ­£åœ¨ä¸ºåœ£ä¸Šå‡†å¤‡...",
            "å®¹å°çš„ä¸ºé™›ä¸‹æ•ˆåŠ³...",
            "å¥´æ‰æ­£åœ¨ä¸ºçš‡ä¸Šæ•´ç†...",
            "è¯·å®¹å¥´æ‰ä¸ºä¸‡å²çˆ·å‡†å¤‡...",
            "å°çš„æ­£åœ¨ä¸ºåœ£ä¸Šç­›é€‰...",
            "å¥´æ‰æ­£åœ¨ä¸ºé™›ä¸‹ç”„é€‰...",
            "æ³è¯·çš‡ä¸Šç¨ä½œä¼‘æ¯...",
            "å¥´æ‰æ­£åœ¨ä¸ºåœ£ä¸Šå¿™ç¢Œ...",
            "å®¹å°çš„ä¸ºä¸‡å²çˆ·æ•ˆåŠ³...",
            "å¥´æ‰æ­£åœ¨ä¸ºé™›ä¸‹å‡†å¤‡...",
            "è¯·å®¹å¥´æ‰ä¸ºçš‡ä¸Šæ•´ç†...",
            "å°çš„æ­£åœ¨ä¸ºåœ£ä¸Šæ•ˆå‘½...",
            "å¥´æ‰æ­£åœ¨ä¸ºä¸‡å²çˆ·ç­›é€‰...",
            "æ³è¯·é™›ä¸‹ç¨å€™ç‰‡åˆ»...",
            "å¥´æ‰æ­£åœ¨ä¸ºçš‡ä¸Šç”„é€‰...",
            "å®¹å°çš„ä¸ºåœ£ä¸Šæ•ˆåŠ³...",
            "å¥´æ‰æ­£åœ¨ä¸ºé™›ä¸‹æ•´ç†...",
            "è¯·å®¹å¥´æ‰ä¸ºä¸‡å²çˆ·å‡†å¤‡...",
            "å°çš„æ­£åœ¨ä¸ºåœ£ä¸Šç­›é€‰...",
            "å¥´æ‰æ­£åœ¨ä¸ºçš‡ä¸Šæ•ˆå‘½...",
            "æ³è¯·ä¸‡å²çˆ·ç¨ç­‰ç‰‡åˆ»...",
            "å¥´æ‰æ­£åœ¨ä¸ºé™›ä¸‹å¿™æ´»..."
        ];

        // å·¦æ»‘æ–‡æ¡ˆ
        const dislikeTexts = [
            "æœ•å·²é˜…",
            "é€€ä¸‹å§",
            "ä¸å‡†å¥",
            "æ— è¶£",
            "æ¯ç‡¥",
            "ä¹å‘³",
            "æœ•ä¸æ‚¦",
            "è’è°¬",
            "èƒ¡é—¹",
            "æ”¾è‚†",
            "å¤§èƒ†",
            "è’å”",
            "ç³Šæ¶‚",
            "ä¸çŸ¥æ‰€è°“",
            "å²‚æœ‰æ­¤ç†",
            "æœ•ç´¯äº†",
            "æœ•ä¹äº†",
            "æœ•å€¦äº†",
            "ä¸‹ä¸€ä¸ª",
            "ä¸å€¼ä¸€çœ‹",
            "ä¼‘å¾—èƒ¡è¨€",
            "ç®€ç›´å¯ç¬‘",
            "æ— ç¨½ä¹‹è°ˆ",
            "æœ•ä¸æƒ³çœ‹",
            "å¤ªè¿‡æ— èŠ",
            "éš¾ç™»å¤§é›…",
            "ä¸çŸ¥å¤©é«˜åœ°åš",
            "ä¸çŸ¥åˆ†å¯¸",
            "å¤ªè¿‡è‰ç‡",
            "æœ•çœ‹ä¸ä¸‹å»äº†",
            "æœ‰è¾±æ–¯æ–‡",
            "è´»ç¬‘å¤§æ–¹",
            "ä¸çŸ¥æ£€ç‚¹",
            "ä¸å ªå…¥ç›®",
            "æœ•ç”šå¤±æœ›",
            "ä¸çŸ¥æ‚”æ”¹",
            "ä¸çŸ¥è¿›é€€",
            "ä¸çŸ¥è½»é‡",
            "ä¸çŸ¥å¥½æ­¹",
            "ä¸çŸ¥ç¾è€»",
            "æœ•å¿ƒçƒ¦äº†",
            "æœ•ä¸å‡†",
            "æœ•ä¸è®¸",
            "æœ•ä¸è¦",
            "ç€å®æ— è¶£",
            "ç”šæ˜¯æ— å‘³",
            "ä»¤æœ•ç”ŸåŒ",
            "ä»¤æœ•ä¸å¿«",
            "ä»¤æœ•åæ„Ÿ",
            "ä»¤æœ•ä½œå‘•"
        ];

        // å³æ»‘æ–‡æ¡ˆ
        const likeTexts = [
            "é¾™é¢œå¤§æ‚¦",
            "å‡†å¥",
            "ç”šå¥½",
            "ä¸é”™",
            "æœ‰è¶£",
            "å¦™å“‰",
            "çˆ±å¿è¯´å¾—å¥½",
            "æœ•å¾ˆæ¬£æ…°",
            "å¯",
            "å‡†",
            "å¾¡ç¬”äº²æ‰¹",
            "æœ•å‡†äº†",
            "ç”šå¦™",
            "å¦™ä¸å¯è¨€",
            "æ·±å¾—æœ•å¿ƒ",
            "æœ•å¾ˆæ»¡æ„",
            "å–„",
            "æå¥½",
            "æœ•ç¬‘äº†",
            "å¿å®¶æœ‰æ‰",
            "æœç„¶ç²¾å½©",
            "æ·±å¾—æœ•æ„",
            "æœ•ç”šæ¬¢å–œ",
            "å¦™ç¬”ç”ŸèŠ±",
            "æ‰æ€æ•æ·",
            "æœ•è¦é‡èµ",
            "å¿å®¶å¦™æ",
            "çœŸä¹ƒå¤§æ‰",
            "æœ•è¦å¤šçœ‹å‡ é",
            "ä¼ æœ•æ—¨æ„",
            "æœ•é¾™å¿ƒå¤§æ‚¦",
            "å¦™ä¸å¯è¨€",
            "ç»å¦™å¥½è¾",
            "æœ•å‡†äº†",
            "ç”šåˆæœ•æ„",
            "çˆ±å¿ç”¨å¿ƒäº†",
            "æœ•å¾ˆå–œæ¬¢",
            "å¯åœˆå¯ç‚¹",
            "ä»¤æœ•å¼€æ€€",
            "å¦™è¶£æ¨ªç”Ÿ",
            "æœ•è¦èµèµ",
            "æœ•è¦å˜‰å¥–",
            "æœ•è¦è¤’å¥–",
            "æœ•è¦è¡¨å½°",
            "æœ•è¦å¤¸èµ",
            "æœ•å¿ƒç”šæ‚¦",
            "æœ•æ„ç”šæ…°",
            "æœ•å¿ƒå¤§å¿«",
            "æœ•æ„å¤§ç•…",
            "æœ•å¿ƒèˆ’ç•…",
            "æœ•å‡†äº† ğŸ‘",
            "ç”šå¥½ ğŸ‘",
            "å¦™å“‰ ğŸ‘",
            "æœ‰è¶£ ğŸ‘",
            "ä¸é”™ ğŸ‘",
            "æœ•å–œæ¬¢ ğŸ‘",
            "å¯ ğŸ‘",
            "å‡†å¥ ğŸ‘",
            "æœ•è§‰å¾—è¡Œ",
            "æœ‰æ„æ€ ğŸ‘",
            "çˆ±å¿ç”¨å¿ƒäº† ğŸ‘",
            "æœ•å¾ˆæ»¡æ„ ğŸ‘",
            "è¿™ä¸ªå¯ä»¥ ğŸ‘",
            "æœ•ç¬‘äº† ğŸ‘",
            "çˆ±å¿æ‡‚æœ• ğŸ‘",
            "æ·±å¾—æœ•å¿ƒ ğŸ‘",
            "è¿™ä¸ªæœ‰è¶£",
            "æœ•è¦èµä½  ğŸ‘",
            "ç”šåˆæœ•æ„ ğŸ‘",
            "çˆ±å¿è´¹å¿ƒäº† ğŸ‘",
            "è¿™ä¸ªæœ•å–œæ¬¢ ğŸ‘",
            "æœ•é¾™å¿ƒå¤§æ‚¦ ğŸ‘",
            "è¿™ä¸ªæœ‰æ°´å¹³ ğŸ‘",
            "çˆ±å¿å¾ˆç”¨å¿ƒ",
            "è¿™ä¸ªæœ•å‡†äº†",
            "æœ•è¦é‡èµ ğŸ‘",
            "è¿™ä¸ªæœ‰æ„æ€ ğŸ‘",
            "æœ•è§‰å¾—ä¸é”™ ğŸ‘",
            "çˆ±å¿å¾ˆæ‡‚äº‹ ğŸ‘",
            "è¿™ä¸ªå€¼å¾—èµ ğŸ‘"
        ];

        // ä½¿ç”¨ GitHub API è·å–ä»“åº“ä¸­ pic æ–‡ä»¶å¤¹çš„å†…å®¹
        const owner = 'psterman';
        const repo = 'dlqpy';
        const path = 'pic';

        // CDN é…ç½®
        const CDN_CONFIGS = {
            // ä¸­å›½å¤§é™†ä¼˜å…ˆä½¿ç”¨è¿™äº› CDN
            CN: [
                'https://gcore.jsdelivr.net/gh',  // Gcore CDN
                'https://fastly.jsdelivr.net/gh', // Fastly CDN
                'https://cdn.jsdelivr.net/gh'     // jsDelivr Main
            ],
            // å…¶ä»–åœ°åŒºä¼˜å…ˆä½¿ç”¨è¿™äº› CDN
            GLOBAL: [
                'https://cdn.jsdelivr.net/gh',
                'https://fastly.jsdelivr.net/gh',
                'https://gcore.jsdelivr.net/gh'
            ]
        };

        // æ£€æµ‹ç”¨æˆ·ä½ç½®å¹¶é€‰æ‹©æœ€ä½³ CDN
        async function detectBestCDN() {
            try {
                // ä½¿ç”¨ ipapi.co æ£€æµ‹ç”¨æˆ·ä½ç½®
                const response = await fetch('https://ipapi.co/json/');
                const data = await response.json();
                const isChina = data.country === 'CN';

                // æµ‹è¯•æ¯ä¸ª CDN çš„å“åº”æ—¶é—´
                const cdnList = isChina ? CDN_CONFIGS.CN : CDN_CONFIGS.GLOBAL;
                const testImage = `${owner}/${repo}@main/${path}/test.jpg`;

                const cdnPromises = cdnList.map(async (cdn) => {
                    const startTime = performance.now();
                    try {
                        const img = new Image();
                        await new Promise((resolve, reject) => {
                            img.onload = resolve;
                            img.onerror = reject;
                            img.src = `${cdn}/${testImage}?t=${Date.now()}`;
                        });
                        return {
                            cdn,
                            time: performance.now() - startTime
                        };
                    } catch {
                        return {
                            cdn,
                            time: Infinity
                        };
                    }
                });

                const results = await Promise.all(cdnPromises);
                results.sort((a, b) => a.time - b.time);
                return results.map(r => r.cdn);
            } catch (error) {
                console.log('CDN detection failed, using default order:', error);
                return CDN_CONFIGS.GLOBAL;
            }
        }

        function getOptimizedImageUrl(url, isMobile) {
            // ç›´æ¥ä½¿ç”¨åŸå§‹ URLï¼Œè®©æµè§ˆå™¨è‡ªå·±å¤„ç†ç¼©æ”¾
            return url;
        }

        async function loadImages() {
            const loadingOverlay = showLoading();
            try {
                // è·å–æœ€ä½³ CDN åˆ—è¡¨
                const cdnList = await detectBestCDN();
                console.log('Using CDN order:', cdnList);

                const response = await fetch(
                    `https://api.github.com/repos/${owner}/${repo}/contents/${path}`
                );

                const files = await response.json();
                images = files
                    .filter(file => file.name.match(/\.(jpg|jpeg|png|gif)$/i))
                    .map(file => ({
                        // ä½¿ç”¨æœ€å¿«çš„ CDN
                        url: `${cdnList[0]}/${owner}/${repo}@main/${path}/${file.name}`,
                        backupUrls: cdnList.slice(1).map(cdn =>
                            `${cdn}/${owner}/${repo}@main/${path}/${file.name}`
                        ),
                        name: file.name
                    }));

                images = _.shuffle(images);

                if (images.length > 0) {
                    const preloadBatch = 5;
                    const imagePromises = [];

                    for (let i = 0; i < Math.min(preloadBatch, images.length); i++) {
                        const img = new Image();
                        img.decoding = 'async';
                        let currentCdnIndex = -1;
                        let retryCount = 0;
                        const maxRetries = 2;  // æ¯ä¸ª CDN æœ€å¤šé‡è¯• 2 æ¬¡

                        const promise = new Promise((resolve) => {
                            img.onload = resolve;
                            img.onerror = () => {
                                if (retryCount < maxRetries) {
                                    retryCount++;
                                    console.log(`Retrying current CDN (${retryCount}/${maxRetries})`);
                                    img.src = img.src + '?t=' + Date.now();
                                } else {
                                    currentCdnIndex++;
                                    retryCount = 0;
                                    if (currentCdnIndex < images[i].backupUrls.length) {
                                        console.log(`Switching to next CDN: ${images[i].backupUrls[currentCdnIndex]}`);
                                        img.src = images[i].backupUrls[currentCdnIndex];
                                    } else {
                                        console.error(`All CDNs failed for ${images[i].name}`);
                                        resolve();
                                    }
                                }
                            };
                            img.src = images[i].url;
                        });
                        imagePromises.push(promise);
                        preloadedImages.set(images[i].url, img);
                    }

                    // è®¾ç½®è¶…æ—¶ï¼Œé˜²æ­¢åŠ è½½å¡ä½
                    const timeout = new Promise(resolve => setTimeout(resolve, 5000));
                    await Promise.race([imagePromises[0], timeout]);
                    hideLoading(loadingOverlay);

                    // æ·»åŠ ç½‘ç»œçŠ¶æ€æ£€æµ‹
                    if (!navigator.onLine) {
                        const offlineHint = document.createElement('div');
                        offlineHint.className = 'error-hint';
                        offlineHint.textContent = 'ç½‘ç»œè¿æ¥ä¸ç¨³å®šï¼Œè¯·æ£€æŸ¥ç½‘ç»œæˆ–å¼€å¯VPN';
                        document.body.appendChild(offlineHint);
                    }

                    if (window.innerWidth <= 768) {
                        showSwipeHint();
                    }
                    showImage(0);
                }
            } catch (error) {
                console.error('Loading error:', error);
                hideLoading(loadingOverlay);
                const errorHint = document.createElement('div');
                errorHint.className = 'error-hint';
                errorHint.textContent = 'åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œæˆ–å¼€å¯VPNååˆ·æ–°é‡è¯•';
                document.body.appendChild(errorHint);
            } finally {
                hideLoading(loadingOverlay);
            }
        }

        function showLoading() {
            const overlay = document.createElement('div');
            overlay.className = 'loading-overlay';

            const text = document.createElement('div');
            text.className = 'loading-text';
            text.textContent = loadingTexts[Math.floor(Math.random() * loadingTexts.length)];

            overlay.appendChild(text);
            document.body.appendChild(overlay);
            return overlay;
        }

        function hideLoading(overlay) {
            overlay.style.opacity = '0';
            overlay.style.transition = 'opacity 0.3s ease';
            setTimeout(() => overlay.remove(), 300);
        }

        function showImage(index) {
            if (!images[index]) return;

            const currentImage = images[index];
            if (!preloadedImages.has(currentImage.url)) {
                const img = new Image();
                img.src = currentImage.url;
                preloadedImages.set(currentImage.url, img);
            }

            const oldContainer = document.querySelector('.image-container');
            if (oldContainer) {
                oldContainer.style.animation = `${currentX > startX ? 'slideOutRight' : 'slideOutLeft'} 0.3s forwards`;
                setTimeout(() => oldContainer.remove(), 300);
            }

            setTimeout(() => {
                const container = document.createElement('div');
                container.className = 'image-container';

                const card = document.createElement('div');
                card.className = 'image-card';

                const img = document.createElement('img');
                img.decoding = 'async';
                img.loading = 'eager';

                const cachedImg = preloadedImages.get(currentImage.url);
                
                // åˆ›å»ºä¸´æ—¶å›¾ç‰‡æ¥è·å–åŸå§‹å°ºå¯¸
                const tempImg = new Image();
                tempImg.src = cachedImg.src;
                
                tempImg.onload = () => {
                    const viewportHeight = window.innerHeight - 120; // å‡å»æŒ‰é’®å’Œpaddingç©ºé—´
                    
                    // è®¡ç®—å›¾ç‰‡åœ¨å®¹å™¨å®½åº¦ä¸‹çš„å®é™…æ˜¾ç¤ºé«˜åº¦
                    const displayHeight = (tempImg.naturalHeight / tempImg.naturalWidth) * window.innerWidth;
                    
                    // åªè¦å›¾ç‰‡æ˜¾ç¤ºé«˜åº¦è¶…è¿‡è§†å£é«˜åº¦ï¼Œå°±è§†ä¸ºé•¿å›¾
                    if (displayHeight > viewportHeight) {
                        // é•¿å›¾å¤„ç†
                        card.style.overflowY = 'scroll';
                        img.style.width = '100%';
                        
                        // æ·»åŠ æ»šåŠ¨æç¤º
                        const scrollHint = document.createElement('div');
                        scrollHint.className = 'scroll-hint';
                        scrollHint.textContent = 'ä¸Šä¸‹æ»‘åŠ¨æŸ¥çœ‹å®Œæ•´å›¾ç‰‡';
                        scrollHint.style.cssText = `
                            position: fixed;
                            top: 50%;
                            left: 50%;
                            transform: translate(-50%, -50%);
                            background-color: var(--counter-bg);
                            padding: 10px 20px;
                            border-radius: 20px;
                            font-size: 14px;
                            color: var(--text-color);
                            opacity: 0.8;
                            transition: opacity 0.3s;
                            z-index: 1002;
                        `;
                        document.body.appendChild(scrollHint);
                        
                        setTimeout(() => {
                            scrollHint.style.opacity = '0';
                            setTimeout(() => scrollHint.remove(), 300);
                        }, 1500);
                    } else {
                        // æ™®é€šå›¾ç‰‡å¤„ç†
                        card.style.overflowY = 'hidden';
                        card.style.alignItems = 'center';
                        img.style.width = '100%';
                        img.style.maxHeight = `${viewportHeight}px`; // é™åˆ¶é«˜åº¦ä¸è¶…è¿‡è§†å£
                    }
                    
                    img.src = cachedImg.src;
                };

                card.appendChild(img);
                container.appendChild(card);
                imageContainer.appendChild(container);

                // æ›´æ–°æ»‘åŠ¨æç¤º
                updateSwipeHint();
            }, oldContainer ? 250 : 0);

            preloadNextImages(index);
        }

        function getRandomText(isLike) {
            const texts = isLike ? likeTexts : dislikeTexts;
            return texts[Math.floor(Math.random() * texts.length)];
        }

        // æ·»åŠ å·¦å³æ»‘åŠ¨å¤„ç†
        let startX = 0;
        let currentX = 0;
        let startTime = 0;  // è®°å½•å¼€å§‹æ»‘åŠ¨çš„æ—¶é—´
        let isMoving = false;  // æ ‡è®°æ˜¯å¦åœ¨æ»‘åŠ¨ä¸­
        let isMouseDown = false;

        // æ·»åŠ é”®ç›˜äº‹ä»¶ç›‘å¬
        document.addEventListener('keydown', handleKeyPress);

        function handleKeyPress(e) {
            const card = document.querySelector('.image-card');
            if (!card) return;

            switch (e.key) {
                case 'ArrowLeft':
                    // å·¦ç®­å¤´ï¼šä¸å–œæ¬¢
                    // å…ˆæ›´æ–°æŒ‰é’®çŠ¶æ€
                    updateButtonsOnSwipe(-window.innerWidth * 0.2);
                    
                    // æ·»åŠ åŠ¨ç”»æ•ˆæœ
                    card.style.transition = 'transform 0.2s ease-out';
                    card.style.transform = 'translateX(-100%)';
                    
                    setTimeout(() => {
                        currentIndex++;
                        showImage(currentIndex);
                        checkAndResetImages();
                        // é‡æ–°åŠ è½½æŒ‰é’®æ–‡æ¡ˆ
                        updateSwipeHint();
                    }, 200);
                    break;

                case 'ArrowRight':
                    // å³ç®­å¤´ï¼šå–œæ¬¢
                    // å…ˆæ›´æ–°æŒ‰é’®çŠ¶æ€
                    updateButtonsOnSwipe(window.innerWidth * 0.2);
                    
                    // æ·»åŠ åŠ¨ç”»æ•ˆæœ
                    card.style.transition = 'transform 0.2s ease-out';
                    card.style.transform = 'translateX(100%)';
                    
                    setTimeout(() => {
                        currentIndex++;
                        funnyCount++;
                        showImage(currentIndex);
                        checkAndResetImages();
                        // é‡æ–°åŠ è½½æŒ‰é’®æ–‡æ¡ˆ
                        updateSwipeHint();
                    }, 200);
                    break;
            }
        }

        // æ£€æŸ¥æ˜¯å¦éœ€è¦é‡ç½®å›¾ç‰‡åˆ—è¡¨
        function checkAndResetImages() {
            if (currentIndex >= images.length) {
                const currentImage = images[currentIndex - 1];  // ä¿å­˜å½“å‰å›¾ç‰‡
                images = _.shuffle(images);
                // ç¡®ä¿æ–°çš„ç¬¬ä¸€å¼ ä¸æ˜¯ä¸Šä¸€è½®çš„æœ€åä¸€å¼ 
                while (images[0].url === currentImage.url && images.length > 1) {
                    images = _.shuffle(images);
                }
                currentIndex = 0;
                showImage(currentIndex);
            }
        }

        imageContainer.addEventListener('touchstart', handleStart);
        imageContainer.addEventListener('touchmove', handleMove);
        imageContainer.addEventListener('touchend', handleEnd);

        // æ·»åŠ é¼ æ ‡äº‹ä»¶ç›‘å¬
        imageContainer.addEventListener('mousedown', handleMouseStart);
        imageContainer.addEventListener('mousemove', handleMouseMove);
        imageContainer.addEventListener('mouseup', handleMouseEnd);
        imageContainer.addEventListener('mouseleave', handleMouseEnd);

        function handleStart(e) {
            const currentTime = Date.now();
            startX = e.touches[0].clientX;
            currentX = startX;
            startTime = Date.now();
            isMoving = true;
        }

        function handleMouseStart(e) {
            isMouseDown = true;
            isMoving = true;
            startX = e.clientX;
            currentX = startX;
            startTime = Date.now();

            // æ·»åŠ æ‹–åŠ¨æ—¶çš„é¼ æ ‡æ ·å¼
            const card = document.querySelector('.image-card');
            card.style.cursor = 'grabbing';
        }

        function handleMove(e) {
            if (!isMoving) return;
            e.preventDefault();
            currentX = e.touches[0].clientX;
            const diff = currentX - startX;

            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            updateButtonsOnSwipe(diff);

            const card = document.querySelector('.image-card');
            if (card) {
                requestAnimationFrame(() => {
                    card.style.transform = `translateX(${diff}px)`;
                });
            }
        }

        function handleMouseMove(e) {
            if (!isMouseDown) return;
            e.preventDefault();
            e.stopPropagation();

            currentX = e.clientX;
            const diff = currentX - startX;

            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            updateButtonsOnSwipe(diff);

            const card = document.querySelector('.image-card');
            if (card) {
                requestAnimationFrame(() => {
                    card.style.transform = `translateX(${diff}px)`;
                });
            }
        }

        function handleEnd(e) {
            if (!isMoving) return;
            isMoving = false;

            const diff = currentX - startX;
            const threshold = window.innerWidth * 0.2;
            const timeElapsed = Date.now() - startTime;
            const velocity = Math.abs(diff) / Math.max(timeElapsed, 1);

            if (Math.abs(diff) > threshold * 0.3 || (Math.abs(diff) > 20 && velocity > 0.2)) {
                if (diff > 0) {  // å³æ»‘è¡¨ç¤ºå–œæ¬¢
                    currentIndex++;
                    funnyCount++;
                } else {  // å·¦æ»‘è¡¨ç¤ºä¸å–œæ¬¢
                    currentIndex++;
                }

                // æ·»åŠ åŠ¨ç”»æ•ˆæœ
                const card = document.querySelector('.image-card');
                if (card) {
                    card.style.transition = 'transform 0.2s ease-out';
                    card.style.transform = `translateX(${diff > 0 ? '100%' : '-100%'})`;
                    setTimeout(() => {
                        showImage(currentIndex);
                        checkAndResetImages();
                        // é‡æ–°åŠ è½½æŒ‰é’®æ–‡æ¡ˆ
                        updateSwipeHint();
                    }, 200);
                }
            } else {
                // æ¢å¤åŸä½çš„åŠ¨ç”»
                const card = document.querySelector('.image-card');
                if (card) {
                    card.style.transition = 'transform 0.2s ease-out';
                    card.style.transform = 'translateX(0)';
                    setTimeout(() => {
                        card.style.transition = '';
                    }, 200);
                }
                // æ¢å¤æŒ‰é’®çŠ¶æ€
                updateButtonsOnSwipe(0);
            }
        }

        function handleMouseEnd(e) {
            if (!isMouseDown) return;
            isMouseDown = false;
            isMoving = false;

            const diff = e.clientX - startX;
            const threshold = window.innerWidth * 0.2;
            const timeElapsed = Date.now() - startTime;
            const velocity = Math.abs(diff) / Math.max(timeElapsed, 1);

            if (Math.abs(diff) > threshold * 0.3 || (Math.abs(diff) > 20 && velocity > 0.2)) {
                if (diff > 0) {  // å³æ»‘è¡¨ç¤ºå–œæ¬¢
                    currentIndex++;
                    funnyCount++;
                } else {  // å·¦æ»‘è¡¨ç¤ºä¸å–œæ¬¢
                    currentIndex++;
                }

                const card = document.querySelector('.image-card');
                if (card) {
                    card.style.transition = 'transform 0.2s ease-out';
                    card.style.transform = `translateX(${diff > 0 ? '100%' : '-100%'})`;
                    setTimeout(() => {
                        showImage(currentIndex);
                        checkAndResetImages();
                        // é‡æ–°åŠ è½½æŒ‰é’®æ–‡æ¡ˆ
                        updateSwipeHint();
                    }, 200);
                }
            } else {
                const card = document.querySelector('.image-card');
                if (card) {
                    card.style.transition = 'transform 0.2s ease-out';
                    card.style.transform = 'translateX(0)';
                    setTimeout(() => {
                        card.style.transition = '';
                    }, 200);
                }
                // æ¢å¤æŒ‰é’®çŠ¶æ€
                updateButtonsOnSwipe(0);
            }
        }

        // é¢„åŠ è½½ä¸‹ä¸€å¼ å›¾ç‰‡
        function preloadNextImages(currentIndex) {
            const preloadCount = 3;  // é¢„åŠ è½½åé¢3å¼ 
            for (let i = 1; i <= preloadCount; i++) {
                const nextIndex = (currentIndex + i) % images.length;
                const nextImage = images[nextIndex];
                if (!preloadedImages.has(nextImage.url)) {
                    const img = new Image();
                    img.src = nextImage.url;
                    preloadedImages.set(nextImage.url, img);
                }
            }
        }

        // æ·»åŠ é€€å‡ºæŒ‰é’®å’Œç»Ÿè®¡åŠŸèƒ½
        function showExitStats() {
            const dialog = document.createElement('div');
            dialog.className = 'stats-dialog';
            // æ·»åŠ é®ç½©å±‚
            const overlay = document.createElement('div');
            overlay.className = 'dialog-overlay';
            document.body.appendChild(overlay);

            const title = document.createElement('h2');
            title.textContent = 'å¾¡è§ˆç»Ÿè®¡';

            const content = document.createElement('p');
            const totalImages = images.length;
            const viewedImages = currentIndex + 1;
            const funnyRate = (funnyCount / viewedImages) * 100;
            content.innerHTML = `
                çˆ±å¿å…±è§ˆå¥æŠ˜ ${viewedImages} ç¯‡<br>
                å…¶ä¸­ä»¤æœ•é¾™é¢œå¤§æ‚¦è€… ${funnyCount} ç¯‡<br>
                é¾™å¿ƒæ‚¦æŒ‡æ•°ï¼š${Math.round(funnyRate)}%<br><br>
                <strong>${getEvaluationText(funnyRate)}</strong><br><br>
                <span style="font-size: 0.9em; opacity: 0.8;">å°å¼Ÿå¾®ä¿¡ï¼šhovgod</span>
            `;

            const confirmButton = document.createElement('button');
            confirmButton.textContent = 'æœ•çŸ¥é“äº†';
            const closeDialog = () => {
                overlay.remove();
                dialog.remove();
            };

            // ç‚¹å‡»é®ç½©å±‚å…³é—­
            overlay.addEventListener('click', closeDialog);
            // ç‚¹å‡»æŒ‰é’®å…³é—­
            confirmButton.addEventListener('click', closeDialog);

            dialog.appendChild(title);
            dialog.appendChild(content);
            dialog.appendChild(confirmButton);
            document.body.appendChild(dialog);

            // ä¿®æ”¹æ ·å¼
            const style = document.createElement('style');
            style.textContent = `
                .dialog-overlay {
                    position: fixed;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    background: rgba(0, 0, 0, 0.5);
                    z-index: 1999;
                }

                .stats-dialog {
                    z-index: 2000;
                    background-color: var(--card-bg);
                    color: var(--text-color);
                    border: 1px solid var(--text-color);
                }

                .stats-dialog button {
                    background-color: var(--card-bg);
                    color: var(--text-color);
                    border: 1px solid var(--text-color);
                    padding: 12px 24px;
                    border-radius: 20px;
                    font-size: 16px;
                    cursor: pointer;
                    margin-top: 20px;
                    -webkit-tap-highlight-color: transparent;
                    transition: transform 0.1s ease;
                }

                .stats-dialog button:active {
                    transform: scale(0.98);
                }

                @media (max-width: 768px) {
                    .stats-dialog {
                        width: 80%;
                        max-width: 320px;
                        padding: 20px;
                    }

                    .stats-dialog button {
                        width: 100%;
                        padding: 15px;
                        margin-top: 15px;
                    }
                }
            `;
            document.head.appendChild(style);
        }

        window.addEventListener('DOMContentLoaded', () => {
            // å¯åŠ¨å›¾ç‰‡åŠ è½½
            loadImages();

            // ä¸»é¢˜è®¾ç½®åˆå§‹åŒ–
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);

            const themeToggle = document.createElement('button');
            themeToggle.className = 'theme-toggle';
            themeToggle.textContent = savedTheme === 'dark' ? 'ğŸŒ åˆ‡æ¢äº®è‰²' : 'ğŸŒ™ åˆ‡æ¢æš—è‰²';
            themeToggle.onclick = toggleTheme;
            document.body.appendChild(themeToggle);

            // æ·»åŠ é€€å‡ºæŒ‰é’®
            const exitButton = document.createElement('button');
            exitButton.className = 'exit-button';
            exitButton.textContent = 'é€€æœ';
            exitButton.onclick = showExitStats;
            document.body.appendChild(exitButton);
        });

        // ä¸»é¢˜åˆ‡æ¢åŠŸèƒ½
        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            const themeToggle = document.querySelector('.theme-toggle');
            themeToggle.textContent = newTheme === 'dark' ? 'ğŸŒ åˆ‡æ¢äº®è‰²' : 'ğŸŒ™ åˆ‡æ¢æš—è‰²';
        }

        // é˜²æ­¢æ»‘åŠ¨è¿‡ç¨‹ä¸­è§¦å‘å…¶ä»–äº‹ä»¶
        imageContainer.addEventListener('click', (e) => {
            if (isMoving) {
                e.preventDefault();
                e.stopPropagation();
            }
        });

        // é˜²æ­¢å›¾ç‰‡æ‹–æ‹½
        imageContainer.addEventListener('dragstart', (e) => {
            e.preventDefault();
        });

        // é˜²æ­¢é•¿å›¾æ»‘åŠ¨æ—¶è§¦å‘å·¦å³åˆ‡æ¢
        let isScrolling = false;
        let scrollTimeout;

        imageContainer.addEventListener('scroll', () => {
            isScrolling = true;
            clearTimeout(scrollTimeout);
            scrollTimeout = setTimeout(() => {
                isScrolling = false;
            }, 100);
        }, true);

        // æ¸…ç†è¿‡æœŸçš„ç¼“å­˜å›¾ç‰‡
        function cleanupImageCache() {
            if (preloadedImages.size > MAX_CACHED_IMAGES * 1.5) {  // å…è®¸æ›´å¤šç¼“å­˜
                const currentUrl = images[currentIndex].url;
                const keysToDelete = Array.from(preloadedImages.keys())
                    .filter(key => key !== currentUrl)
                    .slice(0, preloadedImages.size - MAX_CACHED_IMAGES)
                    .filter(key => {
                        // ä¿ç•™å½“å‰å›¾ç‰‡å‰åå„ 10 å¼ çš„ç¼“å­˜
                        const index = images.findIndex(img => img.url === key);
                        return Math.abs(index - currentIndex) > 10;
                    });

                keysToDelete.forEach(key => {
                    preloadedImages.delete(key);
                });
            }
        }

        // æ·»åŠ ç”¨æˆ·è¡Œä¸ºé¢„æµ‹
        let swipeDirection = null;
        let swipeSpeed = 0;
        const swipeHistory = [];

        function predictNextAction() {
            if (swipeHistory.length < 3) return;

            // åˆ†ææœ€è¿‘çš„æ»‘åŠ¨è¡Œä¸º
            const recentSwipes = swipeHistory.slice(-3);
            const avgSpeed = recentSwipes.reduce((sum, speed) => sum + speed, 0) / 3;
            const direction = recentSwipes[recentSwipes.length - 1] > 0 ? 1 : -1;

            // é¢„æµ‹ä¸‹ä¸€ä¸ªæ–¹å‘å¹¶é¢„åŠ è½½
            const predictedIndex = currentIndex + direction;
            if (predictedIndex >= 0 && predictedIndex < images.length) {
                const predictedImage = images[predictedIndex];
                if (!preloadedImages.has(predictedImage.url)) {
                    const img = new Image();
                    img.src = predictedImage.url;
                    preloadedImages.set(predictedImage.url, img);
                }
            }
        }

        // æ·»åŠ ç§»åŠ¨ç«¯æ»‘åŠ¨æç¤º
        function showSwipeHint() {
            const hint = document.createElement('div');
            hint.className = 'swipe-hint mobile-hint';
            hint.innerHTML = `
                <span class="left-button">ğŸ‘ˆ ${getRandomText(false)}</span>
                <span class="right-button">${getRandomText(true)} ğŸ‘‰</span>
            `;
            document.body.appendChild(hint);
        }

        // ä¿®æ”¹ç§»åŠ¨ç«¯æç¤ºæ ·å¼
        const style = document.createElement('style');
        style.textContent = `
            .swipe-hint {
                position: fixed !important;
                bottom: 20px !important;
                left: 0 !important;
                right: 0 !important;
                z-index: 1000;
                opacity: 1;
                display: flex;
                justify-content: center;
                gap: 20px;
                pointer-events: none;
                background: none !important;
                padding: 10px;
            }

            .swipe-hint span {
                min-width: 120px;
                background-color: rgba(255, 255, 255, 0.9);
                backdrop-filter: blur(5px);
                -webkit-backdrop-filter: blur(5px);
                padding: 10px 15px;
                font-size: 14px;
                border-radius: 20px;
                text-align: center;
                box-shadow: 0 2px 10px var(--shadow-color);
                pointer-events: auto;
                z-index: 1001;
                position: relative;
                white-space: nowrap;
                max-width: 45vw;
                overflow: hidden;
                text-overflow: ellipsis;
                cursor: pointer;
                user-select: none;
                -webkit-tap-highlight-color: transparent;
                transition: transform 0.1s ease;
            }

            .swipe-hint span:active {
                transform: scale(0.98);
            }

            [data-theme="dark"] .swipe-hint span:active {
                background-color: rgba(55, 55, 55, 0.9);
            }

            @media (max-width: 768px) {
                .swipe-hint {
                    bottom: 40px !important;
                    touch-action: manipulation;
                }

                .swipe-hint span {
                    touch-action: manipulation;
                    min-width: 100px;
                    padding: 12px 20px;
                }
            }

            /* ä¼˜åŒ–ç§»åŠ¨ç«¯è§¦æ‘¸åé¦ˆ */
            @media (hover: hover) {
                .swipe-hint span:hover {
                    transform: scale(1.05);
                }
            }
        `;
        document.head.appendChild(style);

        // ä¿®æ”¹æ›´æ–°æ»‘åŠ¨æç¤ºçš„å‡½æ•°
        function updateSwipeHint() {
            const oldHint = document.querySelector('.swipe-hint');
            if (oldHint) {
                oldHint.remove();
            }

            const hint = document.createElement('div');
            hint.className = 'swipe-hint';

            const leftSpan = document.createElement('span');
            leftSpan.className = 'left-button';
            const leftText = `ğŸ‘ˆ ${getRandomText(false)}`;
            leftSpan.innerHTML = leftText;
            leftSpan.setAttribute('data-text', leftText); // ä¿å­˜åˆå§‹æ–‡æ¡ˆ

            const rightSpan = document.createElement('span');
            rightSpan.className = 'right-button';
            const rightText = `${getRandomText(true)} ğŸ‘‰`;
            rightSpan.innerHTML = rightText;
            rightSpan.setAttribute('data-text', rightText); // ä¿å­˜åˆå§‹æ–‡æ¡ˆ

            // ä¿®æ”¹ç‚¹å‡»äº‹ä»¶å¤„ç†
            leftSpan.addEventListener('click', () => {
                // æ˜¾ç¤ºâåŠ¨ç”»
                leftSpan.innerHTML = 'â';
                leftSpan.style.transform = 'translateX(-50%) scale(1.2)';
                rightSpan.style.opacity = '0.5';

                // å»¶è¿Ÿæ‰§è¡Œåˆ‡æ¢å›¾ç‰‡
                setTimeout(() => {
                    currentIndex++;
                    showImage(currentIndex);
                    checkAndResetImages();

                    // é‡æ–°åŠ è½½æŒ‰é’®æ–‡æ¡ˆ
                    updateSwipeHint();
                }, 300);
            });

            rightSpan.addEventListener('click', () => {
                // æ˜¾ç¤ºâ¤ï¸åŠ¨ç”»
                rightSpan.innerHTML = 'â¤ï¸';
                rightSpan.style.transform = 'translateX(50%) scale(1.2)';
                leftSpan.style.opacity = '0.5';

                // å»¶è¿Ÿæ‰§è¡Œåˆ‡æ¢å›¾ç‰‡
                setTimeout(() => {
                    currentIndex++;
                    funnyCount++;
                    showImage(currentIndex);
                    checkAndResetImages();

                    // é‡æ–°åŠ è½½æŒ‰é’®æ–‡æ¡ˆ
                    updateSwipeHint();
                }, 300);
            });

            hint.appendChild(leftSpan);
            hint.appendChild(rightSpan);
            document.body.appendChild(hint);
        }

        // ä¿®æ”¹ updateButtonsOnSwipe å‡½æ•°ï¼Œæ·»åŠ åŠ¨ç”»æŒç»­æ—¶é—´å‚æ•°
        function updateButtonsOnSwipe(diff, duration = 200) {
            const leftButton = document.querySelector('.left-button');
            const rightButton = document.querySelector('.right-button');
            
            if (!leftButton || !rightButton) return;

            const threshold = window.innerWidth * 0.1;

            if (diff < -threshold) { // å·¦æ»‘
                leftButton.innerHTML = 'â';
                leftButton.style.transform = 'scale(1.2)';
                rightButton.style.opacity = '0.5';
                
                // æ·»åŠ è¿‡æ¸¡åŠ¨ç”»
                leftButton.style.transition = `all ${duration}ms ease`;
                rightButton.style.transition = `all ${duration}ms ease`;
            } else if (diff > threshold) { // å³æ»‘
                rightButton.innerHTML = 'â¤ï¸';
                rightButton.style.transform = 'scale(1.2)';
                leftButton.style.opacity = '0.5';
                
                // æ·»åŠ è¿‡æ¸¡åŠ¨ç”»
                leftButton.style.transition = `all ${duration}ms ease`;
                rightButton.style.transition = `all ${duration}ms ease`;
            } else { // æ¢å¤åŸçŠ¶
                // ä¿æŒåŸæœ‰æ–‡æ¡ˆï¼Œåªæ¢å¤æ ·å¼
                leftButton.style.transform = '';
                rightButton.style.transform = '';
                leftButton.style.opacity = '';
                rightButton.style.opacity = '';
                
                // å¦‚æœå½“å‰æ˜¯å›¾æ ‡çŠ¶æ€ï¼Œåˆ™æ¢å¤ä¸ºåŸå§‹æ–‡æ¡ˆ
                if (leftButton.innerHTML === 'â') {
                    leftButton.innerHTML = leftButton.getAttribute('data-text') || `ğŸ‘ˆ ${getRandomText(false)}`;
                }
                if (rightButton.innerHTML === 'â¤ï¸') {
                    rightButton.innerHTML = rightButton.getAttribute('data-text') || `${getRandomText(true)} ğŸ‘‰`;
                }
                
                // æ·»åŠ è¿‡æ¸¡åŠ¨ç”»
                leftButton.style.transition = `all ${duration}ms ease`;
                rightButton.style.transition = `all ${duration}ms ease`;
            }
        }
    </script>
</body>

</html>