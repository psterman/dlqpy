<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Random Image Gallery</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #f0f0f0;
            font-family: Arial, sans-serif;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            text-align: center;
        }
        #imageDisplay {
            max-width: 100%;
            max-height: 80vh;
            margin: 20px auto;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        .button {
            padding: 10px 20px;
            font-size: 16px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px;
        }
        .button:hover {
            background: #45a049;
        }
        .info {
            margin: 10px;
            color: #666;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>随机图片展示</h1>
        <div class="info">
            <span id="folderInfo"></span>
            <br>
            <span id="imageInfo"></span>
            <br>
            <span id="totalInfo"></span>
        </div>
        <img id="imageDisplay" alt="Random Image">
        <br>
        <button class="button" onclick="loadNewImage()">下一张</button>
    </div>
    <script>
        let imageIndex = null;

        // 加载索引文件
        async function loadImageIndex() {
            try {
                const response = await fetch('image_index.json');
                imageIndex = await response.json();
                document.getElementById('totalInfo').textContent = 
                    `总图片数量: ${imageIndex.total_images}`;
                return true;
            } catch (error) {
                console.error('加载索引文件失败:', error);
                return false;
            }
        }

        // 获取随机图片路径
        function getRandomImagePath() {
            if (!imageIndex) return null;
            
            const folders = Object.keys(imageIndex.folders);
            const folder = folders[Math.floor(Math.random() * folders.length)];
            const images = imageIndex.folders[folder];
            const image = images[Math.floor(Math.random() * images.length)];
            return `${folder}/${image}`;
        }

        async function loadNewImage() {
            // 如果索引未加载，先加载索引
            if (!imageIndex && !(await loadImageIndex())) {
                alert('无法加载图片索引');
                return;
            }

            const img = document.getElementById('imageDisplay');
            const imagePath = getRandomImagePath();
            
            if (!imagePath) {
                alert('没有找到可用的图片');
                return;
            }

            img.src = imagePath;
            
            // 更新信息显示
            const folders = Object.keys(imageIndex.folders);
            document.getElementById('folderInfo').textContent = 
                `可用文件夹: ${folders.join(', ')}`;
            document.getElementById('imageInfo').textContent = 
                `当前图片: ${imagePath}`;

            // 处理图片加载错误
            img.onerror = function() {
                console.log('图片加载失败，尝试另一张...');
                loadNewImage();
            };
        }
        
        // 页面加载时获取初始图片
        loadNewImage();
    </script>
</body>

</html>