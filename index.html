<!DOCTYPE html>
<html>
<head>
    <title>大佬请批阅</title>
    <script src="https://cdn.jsdelivr.net/npm/lodash@4.17.21/lodash.min.js"></script>
    <style>
        /* 保留原有样式 */
        .image-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 50px;
        }

        .image-card {
            background-color: var(--card-bg);
            border-radius: 8px;
            box-shadow: 0 2px 4px var(--shadow-color);
            padding: 15px;
            max-width: 90%;
            margin: 0 auto;
        }

        .image-card img {
            max-width: 100%;
            border-radius: 4px;
        }

        #folder-input {
            display: none;
        }

        .folder-button {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 10px 20px;
            background-color: var(--counter-bg);
            border: none;
            border-radius: 20px;
            color: var(--text-color);
            cursor: pointer;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <div id="image-container"></div>

    <script>
        const imageContainer = document.getElementById('image-container');
        let currentIndex = 0;
        let funnyCount = 0;
        let images = [];

        // 使用 GitHub API 获取仓库中 pic 文件夹的内容
        const owner = 'psterman';
        const repo = 'dlqpy';
        const path = 'pic';
        
        async function loadImages() {
            try {
                const response = await fetch(
                    `https://api.github.com/repos/${owner}/${repo}/contents/${path}`
                );
                
                const files = await response.json();
                
                // 过滤出图片文件
                images = files
                    .filter(file => file.name.match(/\.(jpg|jpeg|png|gif)$/i))
                    .map(file => ({
                        url: file.download_url,
                        name: file.name
                    }));

                if (images.length > 0) {
                    images = _.shuffle(images);
                    showImage(0);
                }
            } catch (error) {
                console.error('加载图片失败:', error);
            }
        }

        function showImage(index) {
            imageContainer.innerHTML = '';
            
            const container = document.createElement('div');
            container.className = 'image-container';
            
            const card = document.createElement('div');
            card.className = 'image-card';
            
            const img = document.createElement('img');
            img.src = images[index].url;
            img.alt = images[index].name;
            
            card.appendChild(img);
            container.appendChild(card);
            imageContainer.appendChild(container);
        }

        // 添加左右滑动处理
        let startX = 0;
        let currentX = 0;

        imageContainer.addEventListener('touchstart', handleStart);
        imageContainer.addEventListener('touchmove', handleMove);
        imageContainer.addEventListener('touchend', handleEnd);

        function handleStart(e) {
            startX = e.touches[0].clientX;
            currentX = startX;
        }

        function handleMove(e) {
            currentX = e.touches[0].clientX;
            const diff = currentX - startX;
            const card = document.querySelector('.image-card');
            card.style.transform = `translateX(${diff}px)`;
        }

        function handleEnd(e) {
            const diff = currentX - startX;
            const threshold = window.innerWidth * 0.2;
            
            if (Math.abs(diff) > threshold) {
                if (diff > 0 && currentIndex < images.length - 1) {
                    currentIndex++;
                    funnyCount++;
                    showImage(currentIndex);
                } else if (diff < 0 && currentIndex > 0) {
                    currentIndex--;
                    showImage(currentIndex);
                }
            } else {
                const card = document.querySelector('.image-card');
                card.style.transform = 'translateX(0)';
            }
        }

        // 页面加载时自动加载图片
        window.onload = loadImages;
    </script>
</body>
</html>